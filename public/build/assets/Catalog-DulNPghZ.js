import{r as o,j as t,d as F}from"./app-J0J4XT7Q.js";import{d as I}from"./index-ZjJBU8Ce.js";import{u as N}from"./SalesContext-B1jwJFA9.js";import{n as d}from"./numeral-3Q0ULTA-.js";import{P}from"./PaymentsCheckoutDialog-1nAvnRyt.js";import{D as z,a as B}from"./DialogContent-BvzB3xZG.js";import{D as M}from"./DialogTitle-2KN-Cgy_.js";import{T as R,a as C}from"./Tabs-Cl-X88LN.js";import{B as Y}from"./Badge-Ce_dt518.js";import{c as W}from"./createLucideIcon-CMxlCnxM.js";import{T as w}from"./TextField-B8xGzqYR.js";import{C as E}from"./circle-check-BPQtZqw5.js";import{D as L}from"./DialogActions-3_XUqu2a.js";import{B as q}from"./Button-Bhgpz3NQ.js";import{B as O}from"./banknote-CdquNUWw.js";import"./app-CxSMgHDY.js";import"./Percent-DwVjfmbj.js";import"./createSvgIcon-DH-b1jMs.js";import"./clsx-B-dksMZM.js";import"./memoTheme-BNdxtxoW.js";import"./index-BPJnJB5S.js";import"./Payments-C74n1UUC.js";import"./HighlightOff-C3ZNWjfT.js";import"./index-BOh9Hbob.js";import"./index-B49xHE6m.js";import"./sweetalert2.esm.all-5zhdP7Ax.js";import"./currencyFormatter-DOmpFJHz.js";import"./IconButton-CxCxJBhO.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./useId-bmtMxKKl.js";import"./ButtonBase-ah7Qb79a.js";import"./useTimeout-ijO9WPjY.js";import"./TransitionGroupContext-CUmnvxwJ.js";import"./emotion-react.browser.esm-BQ7e9N_g.js";import"./useForkRef-npmdbavI.js";import"./CircularProgress-Bcsy1Pin.js";import"./x-DSkJY-jh.js";import"./Grid-ByMND7DF.js";import"./useTheme-CwSUTWIJ.js";import"./useThemeProps-ChzuPIZh.js";import"./extendSxProp-CT-SW93I.js";import"./isMuiElement-glFYcxXS.js";import"./InputAdornment-8bA6TaeC.js";import"./useFormControl-bsSDraOa.js";import"./Typography-CWhVrPo-.js";import"./index-i2kla6Uj.js";import"./Divider-CCoppV9R.js";import"./dividerClasses-C03W2_nD.js";import"./TableRow-KnMNmPIP.js";import"./TableCell-CmCRc8xm.js";import"./useSlot-DIICVg-0.js";import"./Paper-CavyNtF_.js";import"./Modal-r73ew4B0.js";import"./ownerWindow-HkKU3E4x.js";import"./ownerDocument-DW-IO8s5.js";import"./Portal-CVCC_lll.js";import"./index-FrVc2Q_M.js";import"./index-DKn53RoO.js";import"./debounce-Be36O1Ab.js";import"./useSlotProps-BwjvMvhT.js";import"./KeyboardArrowRight-CSUedYIP.js";import"./usePreviousProps-BagdRM8M.js";import"./Grow-Bu5k9bsZ.js";import"./mergeSlotProps-D_PRovB-.js";import"./List-CA8Dfjeu.js";import"./ListContext-BTargF9Z.js";import"./useControlled-CIU3udus.js";async function A(){return await I.pos_products.toArray()}/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]],U=W("shopping-cart",Q),oe=({open:n,id:j,onClose:l})=>{const[p,u]=o.useState(""),[x,g]=o.useState([]),[c,r]=o.useState("products"),{cartState:i,addToCart:f,removeFromCart:D,updateCartItem:S}=N(),T=(e,a)=>r(a);o.useEffect(()=>{(async()=>{const e=await A();g(e)})()},[]);const b=e=>{const a=i.findIndex(s=>s.id===e.id&&s.batch_id===e.batch_id);return a===-1?{item:null,index:-1}:{item:i[a],index:a}},y=(e,a,s)=>{const{item:m,index:k}=b(e),h=parseInt(a==="quantity"?s:m?.quantity||0,10),v=parseInt(a==="free_quantity"?s:m?.free_quantity||0,10),_=parseFloat(a==="flat_discount"?s:m?.flat_discount||0);console.log("quantity",h),!h&&!v?D(k):m?S({...m,quantity:h,free_quantity:v,flat_discount:_}):f({...e,free_quantity:v||e.free_quantity||0,flat_discount:_||e.flat_discount||0},h)};return t.jsxs(z,{open:n,onClose:l,fullScreen:!0,children:[t.jsx(M,{children:t.jsxs(R,{value:c,onChange:T,variant:"fullWidth",children:[t.jsx(C,{value:"products",label:"PRODUCTS",wrapped:!0}),t.jsx(C,{value:"cart",label:t.jsx(Y,{badgeContent:i.length,color:"error",children:t.jsx(U,{size:20})})})]})}),t.jsxs(B,{children:[c==="products"&&t.jsxs(t.Fragment,{children:[t.jsx(w,{label:"Search",size:"small",fullWidth:!0,value:p,onChange:e=>u(e.target.value),sx:{mt:1}}),t.jsx("ul",{className:"faded-bottom no-scrollbar grid gap-2 overflow-auto pt-1 pb-1 w-full",children:x.filter(e=>e.name.toLowerCase().includes(p.toLowerCase())).map(e=>{const{item:a}=b(e);return t.jsxs("li",{className:"p-2 w-full shadow-sm",children:[t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{className:"uppercase tracking-wide text-sm text-blue-900 font-semibold",children:[e.name," Rs. ",e.price]}),t.jsx("div",{className:"flex ml-2",children:d(e.stock_quantity).format("0,0")})]}),t.jsxs("div",{className:"mt-2 grid grid-cols-[30px_1fr_1fr_1fr] gap-4 items-center",children:[t.jsx("div",{children:t.jsx(E,{size:30,color:a?"green":"gray"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-500 text-xs",children:"Qty"}),t.jsx("input",{type:"number",min:"0",className:"border border-gray-300 rounded-md py-1 px-2 w-15",value:a?.quantity||"",onFocus:s=>s.target.select(),onChange:s=>y(e,"quantity",s.target.value)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-500 text-xs",children:"Free Qty"}),t.jsx("input",{type:"number",min:"0",className:"border border-gray-300 rounded-md py-1 px-2 w-15",value:a?.free_quantity||"",onFocus:s=>s.target.select(),onChange:s=>y(e,"free_quantity",s.target.value)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-500 text-xs",children:"Disc"}),t.jsx("input",{type:"number",min:"0",className:"border border-gray-300 rounded-md py-1 px-2 w-15",value:a?.flat_discount||"",disabled:!a,onFocus:s=>s.target.select(),onChange:s=>y(e,"flat_discount",s.target.value)})]})]})]},e.id+e.batch_number)})})]}),c==="cart"&&t.jsx($,{cartState:i,contact_id:j,useCart:N})]}),t.jsx(L,{children:t.jsx(q,{fullWidth:!0,onClick:l,children:"Close"})})]})},$=({cartState:n,contact_id:j,useCart:l})=>{const[p,u]=o.useState(!1),[x,g]=o.useState(F().format("YYYY-MM-DD"));if(!n.length)return t.jsx("div",{className:"p-4",children:"Your cart is empty"});const{cartTotal:c}=l();return t.jsxs(t.Fragment,{children:[t.jsxs("ul",{className:"overflow-auto p-0 space-y-2",children:[n.map((r,i)=>{const f=parseFloat(r.price)*r.quantity-r.flat_discount;return t.jsxs("li",{className:"p-3 border rounded-md shadow-sm bg-white",children:[t.jsxs("div",{className:"grid grid-cols-[2fr_1fr] items-center mb-2",children:[t.jsxs("div",{className:"font-semibold text-sm",children:["#",i+1," | ",r.name]}),t.jsxs("div",{className:"text-sm font-bold text-right",children:["Rs. ",d(f).format("0,0.00")]})]}),t.jsxs("div",{className:"grid grid-cols-[1fr_2fr] gap-2 items-center",children:[t.jsx("div",{children:t.jsx("div",{className:"text-gray-500 text-xs",children:"Details"})}),t.jsx("div",{children:t.jsxs("div",{className:"text-gray-500 text-xs text-right",children:["(",r.price," x ",r.quantity,") - ",r.flat_discount," = Rs. ",d(f).format("0,0.00")]})})]})]},`${r.id}-${r.batch_id}`)}),t.jsxs("li",{className:"p-3 border rounded-md shadow-sm bg-white",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("div",{className:"font-semibold text-sm",children:"Item Discount"}),t.jsx("div",{className:"text-sm font-bold",children:d(n.reduce((r,i)=>r+(i.discount*i.quantity+i.flat_discount),0)).format("0,0.00")})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("div",{className:"font-semibold text-sm",children:"Total"}),t.jsxs("div",{className:"text-sm font-bold",children:["Rs. ",d(c).format("0,0.00")]})]})]})]}),t.jsxs("div",{className:"flex justify-center mt-5 flex-col gap-2",children:[t.jsx(w,{type:"date",label:"Date",variant:"outlined",size:"small",value:x,onChange:r=>g(r.target.value),fullWidth:!0,sx:{mt:2}}),t.jsx(q,{variant:"contained",color:"primary",size:"large",fullWidth:!0,endIcon:t.jsx(O,{}),onClick:()=>u(!0),children:"PAYMENTS"})]}),t.jsx(P,{useCart:l,open:p,setOpen:u,selectedContact:{id:j},is_sale:!0,formData:{sale_date:x}})]})};export{oe as default};
