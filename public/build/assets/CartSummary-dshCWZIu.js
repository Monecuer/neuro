import{h as F,r as m,b as _,j as r}from"./app-J0J4XT7Q.js";import{u as k}from"./SalesContext-B1jwJFA9.js";import{A as $}from"./Add-B7dNfvFo.js";import{D as E}from"./Delete-NcfILLQ3.js";import{u as w}from"./currencyFormatter-DOmpFJHz.js";import{L as M}from"./List-CA8Dfjeu.js";import{D as c}from"./Divider-CCoppV9R.js";import{L as d}from"./ListItem-BIq8gZj4.js";import{L as p}from"./ListItemText-DbBV3q1i.js";import{T as t}from"./Typography-CWhVrPo-.js";import{B as s}from"./Box-m8-AwHvJ.js";import{I as O}from"./IconButton-CxCxJBhO.js";import{B as x}from"./Button-Bhgpz3NQ.js";import{D as Q,a as R}from"./DialogContent-BvzB3xZG.js";import{D as N}from"./DialogTitle-2KN-Cgy_.js";import{T as P}from"./TextField-B8xGzqYR.js";import{M as q}from"./MenuItem-D4ZeVUNG.js";import{D as G}from"./DialogActions-3_XUqu2a.js";import"./app-CxSMgHDY.js";import"./createSvgIcon-DH-b1jMs.js";import"./clsx-B-dksMZM.js";import"./memoTheme-BNdxtxoW.js";import"./index-BPJnJB5S.js";import"./numeral-3Q0ULTA-.js";import"./ListContext-BTargF9Z.js";import"./dividerClasses-C03W2_nD.js";import"./isMuiElement-glFYcxXS.js";import"./useForkRef-npmdbavI.js";import"./useSlot-DIICVg-0.js";import"./listItemTextClasses-BS0z-cUj.js";import"./index-i2kla6Uj.js";import"./extendSxProp-CT-SW93I.js";import"./useTheme-CwSUTWIJ.js";import"./emotion-react.browser.esm-BQ7e9N_g.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./useId-bmtMxKKl.js";import"./ButtonBase-ah7Qb79a.js";import"./useTimeout-ijO9WPjY.js";import"./TransitionGroupContext-CUmnvxwJ.js";import"./CircularProgress-Bcsy1Pin.js";import"./Paper-CavyNtF_.js";import"./Modal-r73ew4B0.js";import"./ownerWindow-HkKU3E4x.js";import"./ownerDocument-DW-IO8s5.js";import"./Portal-CVCC_lll.js";import"./index-FrVc2Q_M.js";import"./useFormControl-bsSDraOa.js";import"./debounce-Be36O1Ab.js";import"./index-DKn53RoO.js";import"./useSlotProps-BwjvMvhT.js";import"./Grow-Bu5k9bsZ.js";import"./mergeSlotProps-D_PRovB-.js";import"./useControlled-CIU3udus.js";import"./listItemIconClasses-CtCHhvqe.js";function Kr(){const{cartState:C,cartTotal:h,totalQuantity:b,charges:i,totalChargeAmount:H,finalTotal:J,discount:v,calculateChargeAmountWithDiscount:g,addCharge:A,removeCharge:T}=k(),{settings:S}=F(),[f,D]=m.useState([]),[I,a]=m.useState(!1),[n,u]=m.useState(""),l=w(),j=i.reduce((e,o)=>e+g(o),0),z=h-v+j;m.useEffect(()=>{_.get("/api/charges/active").then(e=>{D(e.data)}).catch(e=>{console.error("Failed to fetch charges:",e)})},[]);const B=()=>{const e=i.map(o=>o.id);return f.filter(o=>!e.includes(o.id))},W=()=>{if(n){const e=f.find(o=>o.id===parseInt(n));e&&(A(e),u(""),a(!1))}},L=e=>{T(e)},y=B();return r.jsxs(M,{sx:{width:"100%",bgcolor:"background.paper",pb:3},children:[r.jsx(c,{sx:{borderBottom:"2px dashed",borderColor:"grey.500",my:1}}),r.jsx(d,{secondaryAction:r.jsx(t,{variant:"h5",color:"initial",sx:{fontSize:{sm:"1rem",xs:"1.2rem"}},children:r.jsxs("strong",{children:[C.length," | Qty. ",b]})}),children:r.jsx(p,{primary:"Total Items"})}),r.jsx(d,{secondaryAction:r.jsx(t,{variant:"h5",color:"initial",sx:{fontSize:{sm:"1rem",xs:"1.2rem"}},children:r.jsx("strong",{children:l(h)})}),children:r.jsx(p,{primary:"Subtotal"})}),r.jsx(c,{sx:{borderBottom:"1px dashed",borderColor:"grey.400",my:1}}),i.length>0&&r.jsxs(r.Fragment,{children:[r.jsxs(s,{sx:{px:2,py:1},children:[r.jsx(t,{variant:"subtitle2",sx:{fontWeight:600,mb:1},children:"Charges & Taxes"}),i.map(e=>r.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,py:.5},children:[r.jsxs(s,{sx:{flex:1},children:[r.jsx(t,{variant:"body2",sx:{fontSize:"0.85rem"},children:e.name}),r.jsx(t,{variant:"caption",sx:{color:"grey.600"},children:e.rate_type==="percentage"?`${e.rate_value}%`:"Fixed"})]}),r.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[r.jsx(t,{variant:"body2",sx:{fontWeight:500,minWidth:"70px",textAlign:"right"},children:l(g(e))}),r.jsx(O,{size:"small",onClick:()=>L(e.id),color:"error",children:r.jsx(E,{sx:{fontSize:"1rem"}})})]})]},e.id))]}),r.jsx(c,{sx:{borderBottom:"1px dashed",borderColor:"grey.400",my:1}})]}),y.length>0&&r.jsx(s,{sx:{px:2,py:1,mb:1},children:r.jsx(x,{variant:"outlined",size:"small",startIcon:r.jsx($,{}),onClick:()=>a(!0),fullWidth:!0,children:"Add Charge"})}),i.length>0&&r.jsx(d,{secondaryAction:r.jsx(t,{variant:"h5",color:"initial",sx:{fontSize:{sm:"1rem",xs:"1.2rem"}},children:r.jsx("strong",{children:l(j)})}),children:r.jsx(p,{primary:"Total Charges"})}),r.jsx(c,{sx:{borderBottom:"2px dashed",borderColor:"grey.500",my:1}}),r.jsx(d,{secondaryAction:r.jsx(t,{variant:"h5",sx:{fontSize:{sm:"1.1rem",xs:"1.3rem"},fontWeight:700,color:"primary.main"},children:l(z)}),children:r.jsx(p,{primary:"FINAL TOTAL",primaryTypographyProps:{sx:{fontWeight:700,fontSize:"1.1rem"}}})}),r.jsxs(Q,{open:I,onClose:()=>a(!1),children:[r.jsx(N,{children:"Add Charge/Tax"}),r.jsx(R,{sx:{minWidth:300,pt:2},children:r.jsx(P,{select:!0,fullWidth:!0,label:"Select Charge",value:n,onChange:e=>u(e.target.value),size:"small",children:y.map(e=>r.jsxs(q,{value:e.id,children:[e.name," (",e.rate_type==="percentage"?`${e.rate_value}%`:`${S.currency_symbol}${e.rate_value}`,")"]},e.id))})}),r.jsxs(G,{children:[r.jsx(x,{onClick:()=>a(!1),children:"Cancel"}),r.jsx(x,{onClick:W,variant:"contained",disabled:!n,children:"Add"})]})]})]})}export{Kr as default};
