import{r as f,c as k,j as t,R as Q,b as U}from"./app-J0J4XT7Q.js";import{C as B}from"./Close-CE33o-VC.js";import{S as E}from"./sweetalert2.esm.all-5zhdP7Ax.js";import{_ as Y}from"./memoTheme-BNdxtxoW.js";import{_ as G,c as V,g as J,a as H,b as P,v as K,d as $,u as X,S as Z}from"./Select-ef7c0426.esm-ORlhB7cR.js";import"./index-FrVc2Q_M.js";import{D as ee,a as te}from"./DialogContent-BvzB3xZG.js";import{D as ae}from"./DialogTitle-2KN-Cgy_.js";import{I as re}from"./IconButton-CxCxJBhO.js";import{G as L}from"./Grid-ByMND7DF.js";import{T as oe,F as ie,I as ne,S as le}from"./TextField-B8xGzqYR.js";import{M as se}from"./MenuItem-D4ZeVUNG.js";import{D as ue}from"./DialogActions-3_XUqu2a.js";import{B as z}from"./Button-Bhgpz3NQ.js";import"./app-CxSMgHDY.js";import"./createSvgIcon-DH-b1jMs.js";import"./clsx-B-dksMZM.js";import"./index-BPJnJB5S.js";import"./toPropertyKey-C9c9JG92.js";import"./TransitionGroupContext-CUmnvxwJ.js";import"./ButtonBase-ah7Qb79a.js";import"./useTimeout-ijO9WPjY.js";import"./emotion-react.browser.esm-BQ7e9N_g.js";import"./useForkRef-npmdbavI.js";import"./floating-ui.dom-CpMS8hwT.js";import"./useTheme-CwSUTWIJ.js";import"./useSlot-DIICVg-0.js";import"./Paper-CavyNtF_.js";import"./Modal-r73ew4B0.js";import"./ownerWindow-HkKU3E4x.js";import"./ownerDocument-DW-IO8s5.js";import"./Portal-CVCC_lll.js";import"./useId-bmtMxKKl.js";import"./Typography-CWhVrPo-.js";import"./index-i2kla6Uj.js";import"./extendSxProp-CT-SW93I.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./CircularProgress-Bcsy1Pin.js";import"./useThemeProps-ChzuPIZh.js";import"./isMuiElement-glFYcxXS.js";import"./useFormControl-bsSDraOa.js";import"./debounce-Be36O1Ab.js";import"./index-DKn53RoO.js";import"./useSlotProps-BwjvMvhT.js";import"./Grow-Bu5k9bsZ.js";import"./mergeSlotProps-D_PRovB-.js";import"./List-CA8Dfjeu.js";import"./ListContext-BTargF9Z.js";import"./useControlled-CIU3udus.js";import"./listItemIconClasses-CtCHhvqe.js";import"./listItemTextClasses-BS0z-cUj.js";import"./dividerClasses-C03W2_nD.js";var pe=["allowCreateWhileLoading","createOptionPosition","formatCreateLabel","isValidNewOption","getNewOptionData","onCreateOption","options","onChange"],q=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",i=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0,p=String(o).toLowerCase(),s=String(l.getOptionValue(i)).toLowerCase(),b=String(l.getOptionLabel(i)).toLowerCase();return s===p||b===p},R={formatCreateLabel:function(o){return'Create "'.concat(o,'"')},isValidNewOption:function(o,i,l,p){return!(!o||i.some(function(s){return q(o,s,p)})||l.some(function(s){return q(o,s,p)}))},getNewOptionData:function(o,i){return{label:i,value:o,__isNew__:!0}}};function me(r){var o=r.allowCreateWhileLoading,i=o===void 0?!1:o,l=r.createOptionPosition,p=l===void 0?"last":l,s=r.formatCreateLabel,b=s===void 0?R.formatCreateLabel:s,n=r.isValidNewOption,C=n===void 0?R.isValidNewOption:n,O=r.getNewOptionData,v=O===void 0?R.getNewOptionData:O,g=r.onCreateOption,_=r.options,d=_===void 0?[]:_,h=r.onChange,u=G(r,pe),e=u.getOptionValue,c=e===void 0?H:e,m=u.getOptionLabel,j=m===void 0?J:m,a=u.inputValue,x=u.isLoading,A=u.isMulti,w=u.value,T=u.name,S=f.useMemo(function(){return C(a,V(w),d,{getOptionValue:c,getOptionLabel:j})?v(a,b(a)):void 0},[b,v,j,c,a,C,d,w]),M=f.useMemo(function(){return(i||!x)&&S?p==="first"?[S].concat(P(d)):[].concat(P(d),[S]):d},[i,p,x,S,d]),W=f.useCallback(function(y,D){if(D.action!=="select-option")return h(y,D);var I=Array.isArray(y)?y:[y];if(I[I.length-1]===S){if(g)g(a);else{var N=v(a,a),F={action:"create-option",name:T,option:N};h(K(A,[].concat(P(V(w)),[N]),N),F)}return}h(y,D)},[v,a,A,T,S,g,h,w]);return $($({},u),{},{options:M,onChange:W})}var ce=f.forwardRef(function(r,o){var i=X(r),l=me(i);return f.createElement(Z,Y({ref:o},l))}),de=ce;const fe=[{value:"Stock Entry",label:"Stock Entry"},{value:"Purchase",label:"Purchase"},{value:"Damaged",label:"Damaged"},{value:"Theft",label:"Theft"},{value:"Expense",label:"Expense"},{value:"Return",label:"Return"},{value:"Donation",label:"Donation"},{value:"Sample",label:"Sample"},{value:"Promotion",label:"Promotion"},{value:"Write-Off",label:"Write-Off"},{value:"Expired",label:"Expired"},{value:"Lost",label:"Lost"},{value:"Transfer Out",label:"Transfer Out"},{value:"Transfer In",label:"Transfer In"},{value:"Production",label:"Production"},{value:"Consumption",label:"Consumption"},{value:"Adjustment",label:"Adjustment"},{value:"Vendor Return",label:"Vendor Return"},{value:"Customer Return",label:"Customer Return"},{value:"Internal Use",label:"Internal Use"},{value:"Audit Correction",label:"Audit Correction"},{value:"Seasonal Adjustment",label:"Seasonal Adjustment"},{value:"Overstock Reduction",label:"Overstock Reduction"},{value:"Understock Adjustment",label:"Understock Adjustment"},{value:"Quality Control Reject",label:"Quality Control Reject"},{value:"Repair",label:"Repair"},{value:"Replacement",label:"Replacement"},{value:"Disposal",label:"Disposal"},{value:"Reconciliation",label:"Reconciliation"},{value:"Miscellaneous",label:"Miscellaneous"}];function dt({modalOpen:r,setModalOpen:o,selectedStock:i,refreshProducts:l,stores:p}){const s=k().props.auth.user,b={batch_id:"",stock_id:"",quantity:0,reason:"",store_id:s.store_id??1},[n,C]=f.useState(b),[O,v]=f.useState(!1),g=()=>{o(!1)},_=async e=>{if(e.preventDefault(),O)return;v(!0);const c=new FormData(e.currentTarget),m=Object.fromEntries(c.entries());m.stock_id=n.stock_id,m.batch_id=n.batch_id,m.store_id=n.store_id,e.nativeEvent.submitter.name=="remove"&&(m.quantity=-Math.abs(n.quantity)),U.post("/quantity/store",m).then(a=>{l(),E.fire({title:"Success!",text:a.data.message,icon:"success",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),C(b),g()}).catch(a=>{let x="An unknown error occurred.";a.response&&a.response.data&&(a.response.data.errors?x=Object.values(a.response.data.errors).flat().join(" | "):x=a.response.data.error||a.response.data.message||x),E.fire({title:"Failed!",text:x,icon:"error",showConfirmButton:!0}),console.error("Error:",a)}).finally(()=>{v(!1)})},d=e=>{C(c=>({...c,batch_id:e.batch_id,stock_id:e.stock_id,store_id:e.store_id??s.store_id}))};f.useEffect(()=>{i&&d(i)},[i]);const h=e=>{const{name:c,value:m}=e.target;C(j=>({...j,[c]:m}))},u=e=>Number(e)!=0&&!isNaN(Number(e));return t.jsx(Q.Fragment,{children:t.jsxs(ee,{fullWidth:!0,maxWidth:"sm",open:r,onClose:g,"aria-labelledby":"alert-dialog-title",component:"form",onSubmit:_,slotProps:{paper:{style:{overflow:"visible"}}},children:[t.jsx(ae,{id:"alert-dialog-title",sx:{alignItems:"center",display:"flex"},children:"QUANTITY ADJUSTMENT"}),t.jsx(re,{"aria-label":"close",onClick:g,sx:e=>({position:"absolute",right:8,top:8,color:e.palette.grey[500]}),children:t.jsx(B,{})}),t.jsx(te,{sx:{overflow:"visible"},children:t.jsxs(L,{container:!0,spacing:2,sx:{justifyContent:"center"},direction:"row",children:[t.jsx(L,{size:12,children:t.jsx(oe,{size:"large",fullWidth:!0,type:"number",name:"quantity",label:"Quantity",variant:"outlined",required:!0,autoFocus:!0,value:n.quantity,onChange:h,sx:{mt:"0.2rem",input:{fontSize:"1.3rem",textAlign:"center"}},onFocus:e=>{e.target.select()},slotProps:{inputLabel:{shrink:!0}}})}),t.jsx(L,{size:12,sx:{mt:"0.6rem"},children:t.jsx("div",{style:{position:"relative",zIndex:999},children:t.jsx(de,{isClearable:!0,options:fe,placeholder:"Select or create a reason",name:"reason",required:!0,menuContainerStyle:{zIndex:999},styles:{control:(e,c)=>({...e,height:"45px",zIndex:999}),menuPortal:e=>({...e,zIndex:999})}})})}),t.jsx(L,{size:12,sx:{mt:"0.6rem"},children:t.jsxs(ie,{sx:{minWidth:"200px",width:"100%"},children:[t.jsx(ne,{children:"Store"}),t.jsx(le,{value:n.store_id,label:"Store",onChange:h,required:!0,name:"store_id",size:"large",children:p.map(e=>t.jsx(se,{value:e.id,children:e.name},e.id))})]})})]})}),t.jsxs(ue,{children:[t.jsx(z,{size:"large",variant:"contained",fullWidth:!0,sx:{paddingY:"6px",fontSize:"1rem"},type:"submit",color:n.quantity<0?"error":"primary",disabled:O||!u(n.quantity),children:n.quantity<0?"REMOVE QUANTITY":"ADD QUANTITY"}),n.quantity>0&&t.jsx(z,{size:"large",variant:"contained",fullWidth:!0,sx:{paddingY:"6px",fontSize:"1rem"},type:"submit",color:"error",name:"remove",value:"remove",disabled:O||!u(n.quantity),children:"REMOVE QUANTITY"})]})]})})}export{dt as default};
