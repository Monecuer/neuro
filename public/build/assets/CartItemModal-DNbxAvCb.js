import{j as t,c as M,r as p,h as w,S as O,R as U}from"./app-J0J4XT7Q.js";import{C as N}from"./Close-CE33o-VC.js";import{V}from"./Visibility-B1KEDVr-.js";import{c as B}from"./createSvgIcon-DH-b1jMs.js";import{u as Y}from"./SalesContext-B1jwJFA9.js";import G from"./Commission-DZY4pu8n.js";import{D as Q,a as $}from"./DialogContent-BvzB3xZG.js";import{D as H}from"./DialogTitle-2KN-Cgy_.js";import{C as J}from"./Chip-rj_j5-pw.js";import{I as q}from"./IconButton-CxCxJBhO.js";import{G as s}from"./Grid-ByMND7DF.js";import{T as a}from"./TextField-B8xGzqYR.js";import{I as l}from"./InputAdornment-8bA6TaeC.js";import{A as K}from"./Alert-Cg00dAYx.js";import{D as X}from"./DialogActions-3_XUqu2a.js";import{B as k}from"./Button-Bhgpz3NQ.js";import"./app-CxSMgHDY.js";import"./clsx-B-dksMZM.js";import"./memoTheme-BNdxtxoW.js";import"./index-BPJnJB5S.js";import"./useTheme-CwSUTWIJ.js";import"./useThemeProps-ChzuPIZh.js";import"./extendSxProp-CT-SW93I.js";import"./isMuiElement-glFYcxXS.js";import"./useSlot-DIICVg-0.js";import"./useForkRef-npmdbavI.js";import"./useId-bmtMxKKl.js";import"./useFormControl-bsSDraOa.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./index-i2kla6Uj.js";import"./emotion-react.browser.esm-BQ7e9N_g.js";import"./TransitionGroupContext-CUmnvxwJ.js";import"./ownerWindow-HkKU3E4x.js";import"./ownerDocument-DW-IO8s5.js";import"./debounce-Be36O1Ab.js";import"./index-DKn53RoO.js";import"./useSlotProps-BwjvMvhT.js";import"./Paper-CavyNtF_.js";import"./Grow-Bu5k9bsZ.js";import"./Portal-CVCC_lll.js";import"./index-FrVc2Q_M.js";import"./useTimeout-ijO9WPjY.js";import"./mergeSlotProps-D_PRovB-.js";import"./Modal-r73ew4B0.js";import"./List-CA8Dfjeu.js";import"./ListContext-BTargF9Z.js";import"./useControlled-CIU3udus.js";import"./Typography-CWhVrPo-.js";import"./ButtonBase-ah7Qb79a.js";import"./CircularProgress-Bcsy1Pin.js";import"./Close-0jcZMw1s.js";const Z=B(t.jsx("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}));function Kt(){const{return_sale:_,cart_first_focus:C,misc_settings:F}=M().props??{},[d,v]=p.useState(!1),m=w(i=>i.settings.currency_symbol),A=()=>v(i=>!i),x=p.useRef(null),{updateCartItem:f}=Y(),{cartItemModalOpen:W,setCartItemModalOpen:P,selectedCartItem:y,setSelectedCartItem:I}=p.useContext(O),[e,b]=p.useState([]),h=()=>{I(null),b([]),v(!1),P(!1)},L=async i=>{if(i.preventDefault(),_){const n={...e,quantity:-Math.abs(e.quantity)};f(n)}else f(e);h()};p.useEffect(()=>{y&&b(y)},[y]);const r=i=>{const{name:n,value:u}=i.target;b(R=>{let o={...R};n==="quantity"&&u===""&&(o.quantity=0),n==="fixed_commission"?o.meta_data={...o.meta_data,fixed_commission:u}:o[n]=u;const j=parseFloat(o.price)||0;if(n==="discount"){const c=parseFloat(u)||0;o.discount_percentage=(c/j*100).toFixed(2)}else if(n==="price")o.discount=parseFloat(o.discount)||0,o.discount_percentage=(o.discount/j*100).toFixed(2);else if(n==="discount_percentage"){const c=parseFloat(u)||0;o.discount=(c/100*j).toFixed(2)}if(o.product_type==="commission"){const c=parseFloat(o.meta_data?.fixed_commission)||0,g=parseFloat(o.price)||0;o.cost=g-c}if(o.product_type==="reload"){const c=parseFloat(o.meta_data?.fixed_commission)||0,g=parseFloat(o.price)||0,S=parseFloat(o.additional_commission)||0,z=parseFloat(o.extra_commission)||0,T=(g-S)*c/100,D=S+z+T;if(o.extra_commission=z,o.commission=D,n==="price"||n==="fixed_commission"||n==="extra_commission"||n==="additional_commission"){const E=parseFloat(o.price)-parseFloat(o.commission)||0;o.cost=E}}return o})};return t.jsx(U.Fragment,{children:t.jsxs(Q,{fullWidth:!0,maxWidth:"sm",open:W,disableRestoreFocus:!0,disableEnforceFocus:!0,onClose:h,"aria-labelledby":"alert-dialog-title",component:"form",onSubmit:L,slotProps:{backdrop:{onTransitionEnd:()=>{x.current&&x.current.focus()}}},"aria-describedby":"dialog-description",children:[t.jsx(H,{id:"alert-dialog-title",children:t.jsxs("div",{children:[t.jsx("span",{className:"mr-1.5",children:e.name}),e.stock_quantity&&e.product_type!=="reload"&&e.stock_quantity!==""?t.jsx(J,{inert:!0,disableElevation:!0,color:parseFloat(e.stock_quantity)<=0?"error":parseFloat(e.stock_quantity)<=parseFloat(e.alert_quantity)?"warning":"primary",size:"small",label:`QTY. ${e.stock_quantity}`}):""]})}),t.jsx(q,{"aria-label":"close",onClick:h,sx:i=>({position:"absolute",right:8,top:8,color:i.palette.grey[500]}),children:t.jsx(N,{})}),t.jsxs($,{children:[t.jsxs(s,{container:!0,spacing:2,children:[t.jsx("input",{type:"hidden",name:"batch_number",value:e.batch_number,onChange:r,inert:!0}),t.jsx("input",{type:"hidden",name:"name",value:e.name,onChange:r,inert:!0}),t.jsx("input",{type:"hidden",name:"id",value:e.id,onChange:r,inert:!0}),t.jsx(s,{size:6,children:e.product_type!=="reload"?t.jsx(a,{fullWidth:!0,type:"number",name:"quantity",label:"Quantity",variant:"outlined",value:e.quantity,onChange:i=>{const n=i.target.value,u=parseFloat(n);r({target:{name:"quantity",value:_&&u>0?-u:u}})},inputRef:C==="quantity"?x:void 0,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},required:!0,onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0}}}):t.jsx(a,{fullWidth:!0,type:"text",name:"account_number",label:"Account Number",variant:"outlined",value:e.account_number,onChange:r,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},autoFocus:!0,required:!0,onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0}}})}),t.jsx(s,{size:6,children:t.jsx(a,{fullWidth:!0,type:"number",name:"price",label:"Price",variant:"outlined",required:!0,value:e.price,onChange:r,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(l,{position:"start",children:m})}}})}),e.product_type==="commission"&&t.jsx(G,{handleChange:r,formState:e}),e.product_type==="reload"&&t.jsx(s,{size:4,children:t.jsx(a,{fullWidth:!0,type:"number",name:"additional_commission",label:"Customer Commission",variant:"outlined",required:!0,value:e.additional_commission,onChange:r,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(l,{position:"start",children:m})}}})}),e.product_type==="reload"&&t.jsx(s,{size:4,children:t.jsx(a,{fullWidth:!0,type:"number",name:"extra_commission",label:"Extra Commission",variant:"outlined",required:!0,value:e.extra_commission,onChange:r,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(l,{position:"start",children:m})}}})}),e.product_type==="reload"&&t.jsx(s,{size:4,children:t.jsx(a,{fullWidth:!0,type:"number",name:"fixed_commission",label:"Fixed Commission",variant:"outlined",required:!0,value:e.meta_data.fixed_commission,onChange:r,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{endAdornment:t.jsx(l,{position:"start",children:"%"})}}})}),e.product_type==="reload"&&t.jsxs(t.Fragment,{children:[t.jsx(s,{size:4,children:t.jsx(a,{fullWidth:!0,type:"number",name:"reload",label:"Reload amount",variant:"outlined",required:!0,value:e.price-e.additional_commission,onChange:r,sx:{mt:"0.5rem",input:{fontSize:"1rem",fontWeight:"bold"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(l,{position:"start",children:m}),readOnly:!0}}})}),t.jsx(s,{size:4,children:t.jsx(a,{fullWidth:!0,type:"number",name:"commission",label:"Total Commission",variant:"outlined",required:!0,value:e.commission,onChange:r,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(l,{position:"start",children:m}),readOnly:!0}}})})]}),e.product_type==="simple"&&t.jsxs(t.Fragment,{children:[F.enable_flat_item_discount==="yes"&&t.jsx(s,{size:{sm:6,xs:6,md:4},children:t.jsx(a,{fullWidth:!0,type:"number",name:"flat_discount",label:"Flat Discount",variant:"outlined",required:!0,value:e.flat_discount??0,onChange:r,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(l,{position:"start",children:m})}}})}),F.enable_unit_discount==="yes"&&t.jsxs(t.Fragment,{children:[t.jsx(s,{size:{sm:6,xs:6,md:4},children:t.jsx(a,{fullWidth:!0,type:"number",name:"discount",label:"Unit Discount",variant:"outlined",required:!0,value:e.discount,onChange:r,inputRef:C==="discount"?x:void 0,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(l,{position:"start",children:m})}}})}),t.jsx(s,{size:{sm:6,xs:6,md:4},children:t.jsx(a,{fullWidth:!0,type:"number",name:"discount_percentage",label:"Unit Discount (%)",variant:"outlined",required:!0,value:e.discount_percentage||0,onChange:r,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{endAdornment:t.jsx(l,{position:"start",children:"%"})}}})})]})]}),t.jsx(s,{size:{sm:12,xs:12,md:4},children:t.jsx(a,{fullWidth:!0,type:d?"number":"text",style:{WebkitTextSecurity:d?"none":"disc",MozTextSecurity:d?"none":"disc",msTextSecurity:d?"none":"disc"},disabled:!d,name:"cost",label:"Cost",variant:"outlined",required:!0,onChange:r,value:e.cost,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{readOnly:e.product_type==="reload",startAdornment:t.jsx(l,{position:"start",children:m}),endAdornment:t.jsx(l,{position:"end",children:t.jsx(q,{"aria-label":"toggle cost visibility",onClick:A,edge:"end",children:d?t.jsx(Z,{}):t.jsx(V,{})})})}}})})]}),e.price-e.discount<e.cost&&t.jsxs(K,{severity:"error",sx:{mt:2},children:["Selling at a ",t.jsx("b",{children:"lower price"}),". Please be cautious."]})]}),t.jsx(X,{children:t.jsxs(s,{container:!0,spacing:1,size:12,justifyContent:"center",width:"100%",children:[e.quantity>0&&t.jsx(s,{size:{xs:6,sm:6},children:t.jsx(k,{variant:"contained",fullWidth:!0,sx:{paddingY:"10px",fontSize:{xs:"1rem",sm:"1.2rem"}},type:"button",color:"error",onClick:i=>{const n={...e,quantity:-Math.abs(e.quantity)};f(n),h()},children:"RETURN"})}),t.jsx(s,{size:{xs:6,sm:6},children:t.jsx(k,{variant:"contained",fullWidth:!0,sx:{paddingY:"10px",fontSize:{xs:"1rem",sm:"1.2rem"}},type:"submit",color:e.quantity<0?"error":"primary",children:e.quantity<0?"RETURN":"UPDATE"})})]})})]})})}export{Kt as default};
