import{j as t,h as ut,c as b,r as i,R as dt,b as L,a as O}from"./app-J0J4XT7Q.js";import{P as mt}from"./Percent-DwVjfmbj.js";import{P as q}from"./Payments-C74n1UUC.js";import{c as G}from"./createSvgIcon-DH-b1jMs.js";import{H as ht}from"./HighlightOff-C3ZNWjfT.js";import{F as pt}from"./index-BOh9Hbob.js";import{f as ft}from"./index-B49xHE6m.js";import{S as M}from"./sweetalert2.esm.all-5zhdP7Ax.js";import{u as xt,t as d}from"./currencyFormatter-DOmpFJHz.js";import{D as gt,a as jt}from"./DialogContent-BvzB3xZG.js";import{D as Ct}from"./DialogTitle-2KN-Cgy_.js";import{I as F}from"./IconButton-CxCxJBhO.js";import{X as bt}from"./x-DSkJY-jh.js";import{G as r}from"./Grid-ByMND7DF.js";import{T as y}from"./TextField-B8xGzqYR.js";import{I as _}from"./InputAdornment-8bA6TaeC.js";import{B as f}from"./Button-Bhgpz3NQ.js";import{D as yt}from"./Divider-CCoppV9R.js";import{T as _t,b as vt,a as Dt}from"./TableRow-KnMNmPIP.js";import{T}from"./TableCell-CmCRc8xm.js";import{D as Pt}from"./DialogActions-3_XUqu2a.js";const V=G(t.jsx("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2m0 14H4v-6h16zm0-10H4V6h16z"})),Y=G(t.jsx("path",{d:"M9 16h2V8H9zm3-14C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m1-4h2V8h-2z"}));function Qt({useCart:J,open:v,setOpen:w,selectedContact:W,formData:Q,is_sale:k=!1}){const E=xt(),D=ut(e=>e.settings.currency_symbol),{cartState:U,cartTotal:l,emptyCart:X,totalProfit:K,charges:R,totalChargeAmount:Z,finalTotal:$,discount:a,setDiscount:m,calculateChargesWithDiscount:P}=J(),tt=b().props.return_sale,et=b().props.sale_id,st=b().props.edit_sale,nt=b().props.sale_id,[S,B]=i.useState(!1),[x,g]=i.useState($-a),[u,j]=i.useState([]),[A,z]=i.useState(0),[h,I]=i.useState(Z),H=l-a+h;i.useEffect(()=>{const e=P(a);I(e),g(l-a+e)},[R,l,a]);const[St,ot]=dt.useState(null),at=()=>{ot(null)},rt=e=>{const o=e.target.value,s=o!==""?parseFloat(o):0;m(s);const c=P(s);I(c)},N=()=>{j([]),z(0),m(0),w(!1)};i.useEffect(()=>{v&&m(0)},[v]),i.useEffect(()=>{const e=l-a+h;g(e),z(u.reduce((o,s)=>o+s.amount,0))},[]),i.useEffect(()=>{z(u.reduce((e,o)=>e+o.amount,0))},[u]);const it=e=>{if(e.preventDefault(),S)return;B(!0);const o=new FormData(e.currentTarget);let s=Object.fromEntries(o.entries());s.discount=d(s.discount),s.net_total=d(H),s.cartItems=U.map(n=>({...n,price:d(n.price),quantity:d(n.quantity),discount:d(n.discount||0)})),s.charges=R.map(n=>({...n,rate_value:d(n.rate_value)})),s.contact_id=W.id,s.payments=u.map(n=>({...n,amount:d(n.amount)})),s={...s,...Q},s.profit_amount=K-a,s.return_sale=tt,s.return_sale_id=et,s.edit_sale_id=nt,s.edit_sale=st;let c="/pos/checkout";k||(c="/purchase/store"),L.post(c,s).then(n=>{M.fire({title:"Success!",text:n.data.message,icon:"success",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),X(),m(0),j([]),k?(O.visit("/receipt/"+n.data.sale_id),L.get("/sale-notification/"+n.data.sale_id).then(p=>{console.log("Notification sent successfully:",p.data.success)}).catch(p=>{console.error("Failed to send notification:",p.response.data.error)})):O.visit("/purchases"),w(!1)}).catch(n=>{const p=JSON.stringify(n.response,Object.getOwnPropertyNames(n));M.fire({title:"Failed!",text:p,icon:"error",showConfirmButton:!0}),console.log(n)}).finally(()=>{B(!1)})},C=e=>{const o=l-a+h,s=A+parseFloat(x);if(o<s)alert("Payment cannot be exceeded the total amount");else if(x){const c={payment_method:e,amount:parseFloat(x)};j([...u,c]);const n=o-s;g(n>0?n:0)}at()},lt=e=>{const o=u.filter((s,c)=>c!==e);j(o)},ct=()=>{if(a<0||a>100){alert("Discount must be between 0 and 100");return}const e=l*a/100;m(e);const o=P(e);I(o)};return t.jsx(t.Fragment,{children:t.jsxs(gt,{fullWidth:!0,fullScreen:window.innerWidth<768,maxWidth:"sm",open:v,onClose:N,"aria-labelledby":"alert-dialog-title",PaperProps:{component:"form",onSubmit:it},children:[t.jsx(Ct,{id:"alert-dialog-title",children:"ADD PAYMENTS"}),t.jsx(F,{"aria-label":"close",onClick:N,sx:e=>({position:"absolute",right:8,top:8,color:e.palette.grey[600]}),children:t.jsx(bt,{size:26})}),t.jsxs(jt,{children:[t.jsxs(r,{container:!0,spacing:2,alignItems:"center",children:[t.jsx(r,{size:{xs:12,sm:6},children:t.jsx(y,{fullWidth:!0,type:"number",name:"discount",label:"Discount",variant:"outlined",value:a,onChange:rt,onFocus:e=>{e.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(_,{position:"start",children:D}),endAdornment:t.jsx(_,{position:"start",children:t.jsx(F,{color:"primary",onClick:ct,children:t.jsx(mt,{fontSize:"small"})})})}}})}),t.jsx(r,{size:{xs:12,sm:6},children:t.jsx(y,{size:"large",fullWidth:!0,type:"number",name:"net_total",label:"Total",variant:"outlined",sx:{input:{fontWeight:"bold"}},value:E(H,!1),onFocus:e=>{e.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(_,{position:"start",children:D}),readOnly:!0}}})}),t.jsxs(r,{container:!0,size:12,flexDirection:"column",alignItems:"center",justifyContent:"center",children:[t.jsx(r,{size:12,sx:{mt:"1rem"},children:t.jsx(y,{autoFocus:!0,fullWidth:!0,type:"number",name:"amount",label:"Amount",variant:"outlined",value:x,onChange:e=>g(e.target.value),onFocus:e=>{e.target.select()},sx:{input:{fontSize:"1.4rem"}},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(_,{position:"start",children:D})}}})}),t.jsxs(r,{size:12,spacing:1,container:!0,justifyContent:"center",children:[t.jsx(r,{size:{xs:6,sm:4},children:t.jsx(f,{fullWidth:!0,component:"label",role:void 0,variant:"contained",startIcon:t.jsx(q,{}),onClick:()=>C("Cash"),color:"success",children:"CASH"})}),W?.id!==1&&t.jsx(r,{size:{xs:6,sm:4},children:t.jsx(f,{fullWidth:!0,component:"label",role:void 0,variant:"contained",startIcon:t.jsx(Y,{}),onClick:()=>C("Credit"),color:"error",children:"CREDIT"})}),t.jsx(r,{size:{xs:6,sm:4},children:t.jsx(f,{fullWidth:!0,component:"label",role:void 0,variant:"contained",startIcon:t.jsx(V,{}),onClick:()=>C("Cheque"),children:"CHEQUE"})}),t.jsx(r,{size:{xs:6,sm:4},children:t.jsx(f,{fullWidth:!0,component:"label",role:void 0,variant:"contained",startIcon:t.jsx(pt,{icon:ft,size:"2xl"}),onClick:()=>C("Card"),children:"CARD"})})]})]})]}),t.jsx(yt,{sx:{py:"0.5rem"}}),t.jsx(_t,{sx:{width:"100%",bgcolor:"background.paper"},children:t.jsx(vt,{children:u.map((e,o)=>t.jsxs(Dt,{children:[t.jsxs(T,{sx:{padding:"5px 16px"},children:[e.payment_method==="Cash"&&t.jsx(q,{}),e.payment_method==="Cheque"&&t.jsx(V,{}),e.payment_method==="Credit"&&t.jsx(Y,{}),t.jsx("span",{className:"ml-2",children:t.jsx("strong",{children:e.payment_method})})]}),t.jsx(T,{align:"right",children:t.jsx("strong",{children:E(e.amount)})}),t.jsx(T,{align:"center",children:t.jsx(F,{edge:"end",color:"error",onClick:()=>lt(o),children:t.jsx(ht,{})})})]},o))})}),t.jsx(y,{fullWidth:!0,variant:"outlined",label:"Note",name:"note",multiline:!0,sx:{mt:"1rem"},size:"large"})]}),t.jsx(Pt,{children:t.jsx(f,{variant:"contained",fullWidth:!0,sx:{paddingY:"15px",fontSize:"1.5rem"},type:"submit",disabled:A-(l-a+h)<0||S||A>l-a+h,children:S?"Loading...":"PAY"})})]})})}export{Qt as P};
