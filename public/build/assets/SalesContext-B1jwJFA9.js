import{r as o,f as F,j as O}from"./app-J0J4XT7Q.js";const N=o.createContext(),k=({children:c,cartType:i="sales_cart",defaultCharges:u=[]})=>{const{cartState:m,addToCart:x,removeFromCart:M,updateProductQuantity:P,emptyCart:C,updateCartItem:S,holdCart:D,setHeldCartToCart:T,removeHeldItem:A}=F(i),[l,s]=o.useState([]),[_,p]=o.useState(0);o.useEffect(()=>{const t=i==="sales_return_cart",e=Array.isArray(u)?u:[];if(e.length>0){const r=e.map(a=>({...a,id:a.id||`charge_${Math.random()}`,rate_value:t?-Math.abs(a.rate_value):Number(a.rate_value)}));s(r)}else s([])},[u,i]);const E=t=>{s(e=>[...e,{...t,id:t.id||`charge_${Date.now()}`}])},w=t=>{s(e=>e.filter(r=>r.id!==t))},Q=(t,e)=>{s(r=>r.map(a=>a.id===t?{...a,...e}:a))},{cartTotal:n,totalQuantity:j,totalProfit:I}=o.useMemo(()=>m.reduce((t,e)=>{const r=Number(e.quantity),a=Number(e.cost),y=Number(e.price),W=Number(e.discount||0),f=Number(e.flat_discount||0),h=y-W,g=h*r-f,B=(h-a)*r-f;return t.cartTotal+=g,t.totalQuantity+=r,t.totalProfit+=B,t},{cartTotal:0,totalQuantity:0,totalProfit:0}),[m]),b=t=>t.rate_type==="percentage"?Math.abs(n)*Number(t.rate_value)/100:Number(t.rate_value),v=(t,e=_)=>{const r=Math.abs(n),a=Math.max(r-e,0);return t.rate_type==="percentage"?a*Number(t.rate_value)/100:Number(t.rate_value)},R=t=>l.reduce((e,r)=>e+v(r,t),0),d=o.useMemo(()=>l.reduce((t,e)=>t+b(e),0),[l,n]),$=o.useMemo(()=>n+d,[n,d]),q=()=>{C();const t=i==="sales_return_cart",e=Array.isArray(u)?u:[];if(e.length>0){const r=e.map(a=>({...a,id:a.id||`charge_${Math.random()}`,rate_value:t?-Math.abs(a.rate_value):Number(a.rate_value)}));s(r)}else s([]);p(0)},H=()=>{C()};return O.jsx(N.Provider,{value:{cartState:m,cartTotal:n,totalQuantity:j,totalProfit:I,charges:l,totalChargeAmount:d,finalTotal:$,discount:_,setDiscount:p,calculateChargeAmount:b,calculateChargeAmountWithDiscount:v,calculateChargesWithDiscount:R,addCharge:E,removeCharge:w,updateCharge:Q,addToCart:x,removeFromCart:M,updateProductQuantity:P,emptyCart:q,emptyCartItemsOnly:H,updateCartItem:S,holdCart:D,setHeldCartToCart:T,removeHeldItem:A},children:c})},z=()=>{const c=o.useContext(N);if(!c)throw new Error("useSales must be used within a SalesProvider");return c};export{k as S,z as u};
