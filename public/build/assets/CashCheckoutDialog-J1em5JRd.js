import{h as V,c as x,r as m,S as K,R as Q,j as t,b as R,a as X}from"./app-J0J4XT7Q.js";import{P as Z}from"./Payments-C74n1UUC.js";import{C as tt}from"./Close-CE33o-VC.js";import{P as et}from"./Percent-DwVjfmbj.js";import{S as W}from"./sweetalert2.esm.all-5zhdP7Ax.js";import{u as ot}from"./SalesContext-B1jwJFA9.js";import{u as rt,t as i}from"./currencyFormatter-DOmpFJHz.js";import{G as g}from"./Grid-ByMND7DF.js";import{B as z}from"./Button-Bhgpz3NQ.js";import{D as nt,a as st}from"./DialogContent-BvzB3xZG.js";import{D as at}from"./DialogTitle-2KN-Cgy_.js";import{I as w}from"./IconButton-CxCxJBhO.js";import{T as d}from"./TextField-B8xGzqYR.js";import{I as p}from"./InputAdornment-8bA6TaeC.js";import{D as it}from"./DialogActions-3_XUqu2a.js";import"./app-CxSMgHDY.js";import"./createSvgIcon-DH-b1jMs.js";import"./clsx-B-dksMZM.js";import"./memoTheme-BNdxtxoW.js";import"./index-BPJnJB5S.js";import"./numeral-3Q0ULTA-.js";import"./useTheme-CwSUTWIJ.js";import"./useThemeProps-ChzuPIZh.js";import"./extendSxProp-CT-SW93I.js";import"./isMuiElement-glFYcxXS.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./useId-bmtMxKKl.js";import"./ButtonBase-ah7Qb79a.js";import"./useTimeout-ijO9WPjY.js";import"./TransitionGroupContext-CUmnvxwJ.js";import"./emotion-react.browser.esm-BQ7e9N_g.js";import"./useForkRef-npmdbavI.js";import"./CircularProgress-Bcsy1Pin.js";import"./useSlot-DIICVg-0.js";import"./Paper-CavyNtF_.js";import"./Modal-r73ew4B0.js";import"./ownerWindow-HkKU3E4x.js";import"./ownerDocument-DW-IO8s5.js";import"./Portal-CVCC_lll.js";import"./index-FrVc2Q_M.js";import"./Typography-CWhVrPo-.js";import"./index-i2kla6Uj.js";import"./useFormControl-bsSDraOa.js";import"./debounce-Be36O1Ab.js";import"./index-DKn53RoO.js";import"./useSlotProps-BwjvMvhT.js";import"./Grow-Bu5k9bsZ.js";import"./mergeSlotProps-D_PRovB-.js";import"./List-CA8Dfjeu.js";import"./ListContext-BTargF9Z.js";import"./useControlled-CIU3udus.js";function ae({disabled:I}){const f=rt(),h=V(o=>o.settings.currency_symbol),D=x().props.return_sale,k=x().props.sale_id,T=x().props.edit_sale,B=x().props.sale_id,{cartState:E,cartTotal:n,totalProfit:N,emptyCart:O,charges:S,totalChargeAmount:G,finalTotal:lt,discount:s,setDiscount:u,calculateChargesWithDiscount:C}=ot(),{selectedCustomer:L,saleDate:Y}=m.useContext(K),[_,P]=m.useState(!1),[l,j]=m.useState(0),[c,b]=m.useState(G),q=window.innerWidth<768,v=n-s+c;m.useEffect(()=>{b(C(s))},[S,n,s]);const M=o=>{const a=o.target.value,e=a!==""?parseFloat(a):0;u(e);const r=C(e);b(r)},[U,y]=Q.useState(!1),$=()=>{u(0),y(!0)},F=()=>{j(0),u(0),y(!1)},H=o=>{if(o.preventDefault(),_)return;P(!0);const a=new FormData(o.currentTarget),e=Object.fromEntries(a.entries());e.amount_received=i(e.amount_received),e.discount=i(e.discount),e.net_total=i(n-s+c),e.change_amount=i(l-(n-s+c)),e.cartItems=E.map(r=>({...r,price:i(r.price),quantity:i(r.quantity),discount:i(r.discount||0)})),e.charges=S.map(r=>({...r,rate_value:i(r.rate_value)})),e.profit_amount=N-s,e.sale_date=Y,e.payment_method="Cash",e.contact_id=L.id,e.return_sale=D,e.return_sale_id=k,e.edit_sale_id=B,e.edit_sale=T,R.post("/pos/checkout",e).then(r=>{W.fire({title:"Success!",text:r.data.message,icon:"success",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),O(),j(0),u(0),X.visit("/receipt/"+r.data.sale_id),R.get("/sale-notification/"+r.data.sale_id).then(A=>{console.log("Notification sent successfully:",A.data.success)}).catch(A=>{console.error("Failed to send notification:",A.response.data.error)}),y(!1)}).catch(r=>{W.fire({title:"Failed!",text:r.response.data.error,icon:"error",showConfirmButton:!0}),console.log(r)}).finally(()=>{P(!1)})},J=()=>{if(s<0||s>100){alert("Discount must be between 0 and 100");return}const o=n*s/100;u(o);const a=C(o);b(a)};return t.jsxs(g,{size:12,children:[t.jsx(z,{variant:"contained",color:"success",sx:{paddingY:"15px",flexGrow:"1"},size:"large",endIcon:t.jsx(Z,{}),onClick:$,disabled:I,fullWidth:!0,children:v<0?`REFUND ${f(Math.abs(v))}`:`CASH ${f(v)}`}),t.jsxs(nt,{fullWidth:!0,maxWidth:"sm",open:U,onClose:F,"aria-labelledby":"alert-dialog-title",PaperProps:{component:"form",onSubmit:H},fullScreen:q,children:[t.jsx(at,{id:"alert-dialog-title",children:"Cash Checkout"}),t.jsx(w,{"aria-label":"close",onClick:F,sx:o=>({position:"absolute",right:8,top:8,color:o.palette.grey[500]}),children:t.jsx(tt,{})}),t.jsxs(st,{children:[t.jsx(d,{id:"txtAmount",fullWidth:!0,autoFocus:!0,variant:"outlined",label:n<0?"Refund":"Amount Received",type:"number",name:"amount_received",onFocus:o=>{o.target.select()},onChange:o=>{const a=o.target.value,e=parseFloat(a);j(D&&e>0?-e:e)},sx:{input:{textAlign:"center",fontSize:"2rem"}},value:l,slotProps:{input:{style:{textAlign:"center"},placeholder:n<0?"Refund Amount":"Amount Received",startAdornment:t.jsx(p,{position:"start",children:h})}}}),t.jsx(d,{fullWidth:!0,id:"txtDiscount",type:"number",name:"discount",label:"Discount",variant:"outlined",value:s,sx:{mt:"1.5rem",input:{textAlign:"center",fontSize:"2rem"}},onChange:M,onFocus:o=>{o.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(p,{position:"start",children:h}),endAdornment:t.jsx(p,{position:"start",children:t.jsx(w,{color:"primary",onClick:J,children:t.jsx(et,{fontSize:"large"})})})}}}),t.jsxs(g,{container:!0,spacing:{xs:2,md:1},mt:3,children:[t.jsx(g,{size:{xs:12,sm:6},children:t.jsx(d,{fullWidth:!0,label:"Payable Amount",variant:"outlined",name:"net_total",value:f(n-s+c,!1),sx:{input:{textAlign:"center",fontSize:"2rem"}},slotProps:{input:{readOnly:!0,style:{textAlign:"center"},startAdornment:t.jsx(p,{position:"start",children:h})}}})}),t.jsx(g,{size:{xs:12,sm:6},children:t.jsx(d,{id:"txtChange",fullWidth:!0,label:"Change",variant:"outlined",name:"change_amount",sx:{input:{textAlign:"center",fontSize:"2rem"}},value:f(l-(n-s+c),!1),slotProps:{input:{readOnly:!0,startAdornment:t.jsx(p,{position:"start",children:h})}}})})]}),t.jsx(d,{fullWidth:!0,variant:"outlined",label:"Note",name:"note",multiline:!0,sx:{mt:"2rem"}})]}),t.jsx(it,{children:t.jsx(z,{variant:"contained",fullWidth:!0,sx:{paddingY:"15px",fontSize:"1.5rem"},type:"submit",disabled:!l||n<0&&l===0||n<0&&l!=n-s+c||n>=0&&l-(n-s+c)<0||_,children:_?"Loading...":n<0?"REFUND":"PAY"})})]})]})}export{ae as default};
