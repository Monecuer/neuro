import{j as s,c as j,r as o,S as v,b as B}from"./app-J0J4XT7Q.js";import{c as k}from"./createSvgIcon-DH-b1jMs.js";import{_ as f}from"./lodash-DOrSYvRZ.js";import{u as E}from"./SalesContext-B1jwJFA9.js";import{B as w}from"./Box-m8-AwHvJ.js";import{A}from"./Autocomplete-tKHD7bsB.js";import{T as O}from"./TextField-B8xGzqYR.js";import{D as R}from"./Divider-CCoppV9R.js";import{I as $}from"./IconButton-CxCxJBhO.js";import"./app-CxSMgHDY.js";import"./clsx-B-dksMZM.js";import"./memoTheme-BNdxtxoW.js";import"./index-BPJnJB5S.js";import"./useTheme-CwSUTWIJ.js";import"./extendSxProp-CT-SW93I.js";import"./Close-0jcZMw1s.js";import"./useSlot-DIICVg-0.js";import"./useForkRef-npmdbavI.js";import"./useId-bmtMxKKl.js";import"./useControlled-CIU3udus.js";import"./usePreviousProps-BagdRM8M.js";import"./TransitionGroupContext-CUmnvxwJ.js";import"./Portal-CVCC_lll.js";import"./index-FrVc2Q_M.js";import"./Paper-CavyNtF_.js";import"./Popper-DhnmPy4J.js";import"./index-DKn53RoO.js";import"./ownerDocument-DW-IO8s5.js";import"./useSlotProps-BwjvMvhT.js";import"./Chip-rj_j5-pw.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./ButtonBase-ah7Qb79a.js";import"./useTimeout-ijO9WPjY.js";import"./emotion-react.browser.esm-BQ7e9N_g.js";import"./useFormControl-bsSDraOa.js";import"./index-i2kla6Uj.js";import"./ownerWindow-HkKU3E4x.js";import"./debounce-Be36O1Ab.js";import"./Grow-Bu5k9bsZ.js";import"./mergeSlotProps-D_PRovB-.js";import"./Modal-r73ew4B0.js";import"./List-CA8Dfjeu.js";import"./ListContext-BTargF9Z.js";import"./isMuiElement-glFYcxXS.js";import"./dividerClasses-C03W2_nD.js";import"./CircularProgress-Bcsy1Pin.js";const q=k(s.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}));function wt(){const h=j().props.return_sale,{setCartItemModalOpen:d,setSelectedCartItem:p}=o.useContext(v),{addToCart:m,cartState:i}=E(),[D,a]=o.useState(!1),[F,x]=o.useState(""),[g,b]=o.useState([]),[y,S]=o.useState(""),c=o.useRef(null),I=t=>{t.length>2&&(a(!0),B.get("/products/search",{params:{search_query:t}}).then(e=>{if(b(e.data.products),a(!1),e.data.products.length===1){const r=e.data.products;if(r[0].discount_percentage&&Number(r[0].discount_percentage)!==0){const n=r[0].price*r[0].discount_percentage/100;r[0].discount=n}const l=f.findIndex(i,n=>n.id===r.id&&n.batch_number===r.batch_number&&!["custom","reload"].includes(n.product_type));if(l!==-1?r[0].quantity=i[l].quantity:(r[0].quantity=1,m(r[0])),r[0].product_type==="reload"){const n=i.length>0?i.length:0;r[0].cart_index=n}p(r[0]),d(!0)}}).catch(e=>{console.error(e),a(!1)}))},u=o.useCallback(f.debounce(t=>{I(t)},300),[]);o.useEffect(()=>(c.current&&c.current.focus(),()=>{u.cancel()}),[u]);const _=t=>{const e=t.target.value;x(e),u(e)};o.useEffect(()=>{document.addEventListener("keydown",C,!0)},[]);const C=t=>{if(t.key==="ArrowUp"){t.preventDefault();const e=document.getElementById("searchBox");e&&(e.focus(),e.select())}};return s.jsx(s.Fragment,{children:s.jsxs(w,{elevation:0,sx:{p:"2px 2px",ml:{sm:"2rem",xs:"0.5rem"},display:"flex",alignItems:"center",width:"100%",height:"55px",backgroundColor:"white",borderRadius:"5px"},children:[s.jsx(A,{id:"searchBox",disabled:h,fullWidth:!0,disableCloseOnSelect:!0,freeSolo:!0,options:g,inputValue:y,handleHomeEndKeys:!0,onInputChange:(t,e)=>{S(e)},getOptionLabel:t=>typeof t=="string"?t:`${t.name} | ${t.barcode} ${t.sku?`| ${t.sku}`:""} | ${t.batch_number} | Rs.${t.price}`,getOptionKey:t=>t.id+t.batch_id,onChange:(t,e)=>{if(e&&typeof e=="object"&&e.id){if(m(e),e.quantity=1,e.product_type==="reload"){const r=i.length>0?i.length:0;e.cart_index=r}p(e),d(!0)}},renderInput:t=>s.jsx(O,{...t,inputRef:c,fullWidth:!0,placeholder:"Search product... Use Arrow up key to focus ⬆️",id:"searchBox",onChange:_,onFocus:e=>{e.target.select()},sx:{"& .MuiOutlinedInput-root":{"& fieldset":{border:"none"},"&:hover fieldset":{border:"none"},"&.Mui-focused fieldset":{border:"none"}}}})}),s.jsx(R,{sx:{height:28,m:.5},orientation:"vertical"}),s.jsx($,{type:"button",sx:{p:"10px"},"aria-label":"search",children:s.jsx(q,{})})]})})}export{wt as default};
